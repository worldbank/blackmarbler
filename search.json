[{"path":"/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2023 Robert Marty Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"/articles/blackmarbler-vignette.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"Black Marble Nighttime Lights","text":"fill .","code":""},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Robert Marty. Author, maintainer.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Marty R (2023). blackmarbler: Black Marble R. R package version 0.1.0, https://worldbank.github.io/blackmarbler/.","code":"@Manual{,   title = {blackmarbler: Black Marble R},   author = {Robert Marty},   year = {2023},   note = {R package version 0.1.0},   url = {https://worldbank.github.io/blackmarbler/}, }"},{"path":"/index.html","id":"blackmarbler-","dir":"","previous_headings":"","what":"Black Marble R","title":"Black Marble R","text":"BlackMarbleR R package working Black Marble data. Black Marble NASA Earth Observatory project provides global nighttime lights data. package automates process downloading relevant tiles NASA LAADS archive cover region interest, converting raw files (H5 format) georeferenced rasters, mosaicing rasters together needed. Installation Bearer token Setup Make raster Make raster stack across multiple time periods Make map Make figure trends nighttime lights Workflow update data Functions Required Arguments Optional Arguments Argument bm_extract","code":""},{"path":"/index.html","id":"installation-","dir":"","previous_headings":"","what":"Installation","title":"Black Marble R","text":"package can installed via devtools.","code":"# install.packages(\"devtools\") devtools::install_github(\"worldbank/blackmarbler\")"},{"path":"/index.html","id":"bearer-token-","dir":"","previous_headings":"","what":"Bearer Token","title":"Black Marble R","text":"function requires using Bearer Token; obtain token, follow steps: Go NASA LAADS Archive Click “Login” (bottom top right); create account needed. Click “See wget Download Command” (bottom near top, middle) clicking, see text can used download data. “Bearer” token long string red.","code":""},{"path":[]},{"path":"/index.html","id":"setup-","dir":"","previous_headings":"Usage","what":"Setup","title":"Black Marble R","text":"downloading extracting Black Marble data, first load packages, define NASA bearer token, define region interest.","code":"#### Setup # Load packages library(blackmarbler) library(geodata) library(sf) library(raster) library(ggplot2)  #### Define NASA bearer token bearer <- \"BEARER-TOKEN-HERE\"  ### ROI # Define region of interest (roi). The roi must be (1) an sf polygon and (2) # in the WGS84 (epsg:4326) coordinate reference system. Here, we use the  # getData function to load a polygon of Ghana roi_sf <- gadm(country = \"GHA\", level=1, path = tempdir()) |> st_as_sf()"},{"path":"/index.html","id":"make-raster-of-nighttime-lights-","dir":"","previous_headings":"Usage","what":"Make raster of nighttime lights","title":"Black Marble R","text":"example shows making daily, monthly, annual rasters nighttime lights Ghana.","code":"### Daily data: raster for February 5, 2021 r_20210205 <- bm_raster(roi_sf = roi_sf,                         product_id = \"VNP46A2\",                         date = \"2021-02-05\",                         bearer = bearer)  ### Monthly data: raster for October 2021 r_202110 <- bm_raster(roi_sf = roi_sf,                       product_id = \"VNP46A3\",                       date = \"2021-10-01\", # The day is ignored                       bearer = bearer)  ### Annual data: raster for 2021 r_2021 <- bm_raster(roi_sf = roi_sf,                     product_id = \"VNP46A4\",                     date = 2021,                     bearer = bearer)"},{"path":"/index.html","id":"make-raster-stack-of-nighttime-lights-across-multiple-time-periods-","dir":"","previous_headings":"Usage","what":"Make raster stack of nighttime lights across multiple time periods","title":"Black Marble R","text":"extract data multiple time periods, add multiple time periods date. function return raster stack, raster band corresponds different date. code provides examples getting data across multiple days, months, years.","code":"#### Daily data in March 2021 r_daily <- bm_raster(roi_sf = roi_sf,                      product_id = \"VNP46A3\",                      date = seq.Date(from = ymd(\"2021-03-01\"), to = ymd(\"2021-03-31\"), by = \"day\"),                      bearer = bearer)  #### Monthly aggregated data in 2021 and 2022 r_monthly <- bm_raster(roi_sf = roi_sf,                        product_id = \"VNP46A3\",                        date = seq.Date(from = ymd(\"2021-01-01\"), to = ymd(\"2022-12-01\"), by = \"month\"),                        bearer = bearer)  #### Yearly aggregated data in 2012 and 2021 r_annual <- bm_raster(roi_sf = roi_sf,                       product_id = \"VNP46A4\",                       date = 2012:2021,                       bearer = bearer)"},{"path":"/index.html","id":"map-of-nighttime-lights-","dir":"","previous_headings":"Usage","what":"Map of nighttime lights","title":"Black Marble R","text":"Using one rasters, can make map nighttime lights","code":"#### Make raster r <- bm_raster(roi_sf = roi_sf,                product_id = \"VNP46A3\",                date = \"2021-10-01\",                bearer = bearer)                 #### Prep data r <- r |> mask(roi_sf)   r_df <- rasterToPoints(r, spatial = TRUE) |> as.data.frame() names(r_df) <- c(\"value\", \"x\", \"y\")  ## Remove very low values of NTL; can be considered noise  r_df$value[r_df$value <= 2] <- 0  ## Distribution is skewed, so log r_df$value_adj <- log(r_df$value+1)  ##### Map  p <- ggplot() +   geom_raster(data = r_df,    aes(x = x, y = y,    fill = value_adj)) +   scale_fill_gradient2(low = \"black\",                        mid = \"yellow\",                        high = \"red\",                        midpoint = 4.5) +   labs(title = \"Nighttime Lights: October 2021\") +   coord_quickmap() +    theme_void() +   theme(plot.title = element_text(face = \"bold\", hjust = 0.5),   legend.position = \"none\")"},{"path":"/index.html","id":"trends-over-time-","dir":"","previous_headings":"Usage","what":"Trends over time","title":"Black Marble R","text":"can use bm_extract function observe changes nighttime lights time. bm_extract function leverages exactextractr package aggregate nighttime lights data polygons. show trends annual nighttime lights data across Ghana’s first administrative divisions.","code":"#### Extract annual data ntl_df <- bm_extract(roi_sf = roi_sf,                      product_id = \"VNP46A4\",                      date = 2012:2022,                      bearer = bearer)  #### Trends over time ntl_df |>   ggplot() +   geom_col(aes(x = date,   y = ntl_mean),   fill = \"darkorange\") +   facet_wrap(~NAME_1) +   labs(x = NULL,        y = \"NTL Luminosity\",        title = \"Ghana Admin Level 1: Annual Average Nighttime Lights\") +   theme_minimal() +   theme(strip.text = element_text(face = \"bold\"))"},{"path":"/index.html","id":"workflow-to-update-data-","dir":"","previous_headings":"Usage","what":"Workflow to update data","title":"Black Marble R","text":"users may want monitor near-real-time changes nighttime lights. example, daily Black Marble nighttime lights data updated regularly, data available roughly week delay; use cases may require examining trends daily nighttime lights data new data becomes available. shows example code regularly run produce updated daily dataset nighttime lights. code produces dataframe nighttime lights date, average nighttime lights Ghana’s 1st administrative division produced. code check whether data already downloaded/extracted specific date, download/extract new data.","code":"# Create directories to store data dir.create(file.path(getwd(), \"bm_files\")) dir.create(file.path(getwd(), \"bm_files\", \"daily\"))  # Extract daily-level nighttime lights data for Ghana's first administrative divisions.  # Save a separate dataset for each date in the `\"~/Desktop/bm_files/daily\"` directory.  # The code extracts data from January 1, 2023 to today. Given that daily nighttime lights  # data is produced on roughly a week delay, the function will only extract data that exists;  # it will skip extracting data for dates where data has not yet been produced by NASA Black Marble.  bm_extract(roi_sf = roi_sf,            product_id = \"VNP46A2\",            date = seq.Date(from = ymd(\"2023-01-01\"), to = Sys.Date(), by = 1),            bearer = bearer,            output_location_type = \"file\",            file_dir = file.path(getwd(), \"bm_files\", \"daily\"))  # Append daily-level datasets into one file file.path(getwd(), \"bm_files\", \"daily\") |>   list.files(pattern = \"*.Rds\",   full.names = T) |>   map_df(readRDS) |>   saveRDS(file.path(getwd(), \"bm_files\", \"ntl_daily.Rds\"))"},{"path":[]},{"path":"/index.html","id":"functions-","dir":"","previous_headings":"Functions and arguments","what":"Functions","title":"Black Marble R","text":"package provides two functions. bm_raster produces raster Black Marble nighttime lights. bm_extract produces dataframe aggregated nighttime lights region interest (e.g., average nighttime lights within US States). functions take following arguments:","code":""},{"path":"/index.html","id":"required-arguments-","dir":"","previous_headings":"Functions and arguments","what":"Required arguments","title":"Black Marble R","text":"roi_sf: Region interest; sf polygon. Must WGS 84 (epsg:4326) coordinate reference system. bm_extract, aggregates nighttime lights within polygon roi_sf. product_id: One following: \"VNP46A1\": Daily (raw) \"VNP46A2\": Daily (corrected) \"VNP46A3\": Monthly \"VNP46A4\": Annual date: Date raster data. Entering one date produce raster. Entering multiple dates produce raster stack. product_ids \"VNP46A1\" \"VNP46A2\", date (eg, \"2021-10-03\"). product_id \"VNP46A3\", date year-month (e.g., \"2021-10-01\", day ignored, \"2021-10\"). product_id \"VNP46A4\", year date (e.g., \"2021-10-01\", month day ignored, 2021). bearer: NASA bearer token. instructions create token, see .","code":""},{"path":"/index.html","id":"optional-arguments-","dir":"","previous_headings":"Functions and arguments","what":"Optional arguments","title":"Black Marble R","text":"variable: Variable used create raster (default: NULL). information variable choices, see ; VNP46A1, see Table 3; VNP46A2 see Table 6; VNP46A3 VNP46A4, see Table 9. NULL, uses following default variables: product_id \"VNP46A1\", uses DNB_At_Sensor_Radiance_500m. product_id \"VNP46A2\", uses Gap_Filled_DNB_BRDF-Corrected_NTL. product_ids \"VNP46A3\" \"VNP46A4\", uses NearNadir_Composite_Snow_Free. quality_flag_rm: Quality flag values use set values NA. pixel quality flag value, low quality values can removed. Values set NA value ther quality_flag_rm vector. (Default: c(255)). 0: High-quality, Persistent nighttime lights 1: High-quality, Ephemeral nighttime Lights 2: Poor-quality, Outlier, potential cloud contamination, issues 255: retrieval, Fill value (masked ingestion) 0: Good-quality, number observations used composite larger 3 1: Poor-quality, number observations used composite less equal 3 2: Gap filled NTL based historical data 255: Fill value output_location_type: output stored (default: r_memory). Either: r_memory function return output R file function export data file. bm_raster, .tif file saved; bm_extract, .Rds file saved. file saved date. Consequently, date = c(2018, 2019, 2020), three datasets saved: one year. Saving dataset date can facilitate re-running function later downloading data dates data downloaded. output_location_type = \"file\", following arguments can used: file_dir: directory data exported (default: NULL, working directory used) file_prefix: Prefix add file saved. file saved following: [file_prefix][product_id]_t[date].[tif/Rds] file_skip_if_exists: Whether function first check wither file already exists, skip downloading extracting data data date file already exists (default: TRUE). function first run date = c(2018, 2019, 2020), later run date = c(2018, 2019, 2020, 2021), function download/extract data 2021. Skipping existing files can facilitate re-running function later date download recent data.","code":""},{"path":"/index.html","id":"argument-for-bm_extract-only-","dir":"","previous_headings":"Functions and arguments","what":"Argument for bm_extract only","title":"Black Marble R","text":"aggregation_fun: vector functions aggregate data (default: \"mean\"). exact_extract function exactextractr package used aggregations; parameter passed fun argument exactextractr::exact_extract.","code":""},{"path":"/reference/bm_extract.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract and Aggregate Black Marble Data — bm_extract","title":"Extract and Aggregate Black Marble Data — bm_extract","text":"Extract aggregate nighttime lights data NASA Black Marble data","code":""},{"path":"/reference/bm_extract.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract and Aggregate Black Marble Data — bm_extract","text":"","code":"bm_extract(   roi_sf,   product_id,   date,   bearer,   aggregation_fun = c(\"mean\"),   variable = NULL,   quality_flag_rm = 255,   check_all_tiles_exist = TRUE,   output_location_type = \"memory\",   file_dir = NULL,   file_prefix = NULL,   file_skip_if_exists = TRUE,   quiet = FALSE )"},{"path":"/reference/bm_extract.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract and Aggregate Black Marble Data — bm_extract","text":"roi_sf Region interest; sf polygon. Must WGS 84 (epsg:4326) coordinate reference system. product_id One following: \"VNP46A1\": Daily (raw) \"VNP46A2\": Daily (corrected) \"VNP46A3\": Monthly \"VNP46A4\": Annual date Date raster data. Entering one date produce raster. Entering multiple dates produce raster stack. product_ids \"VNP46A1\" \"VNP46A2\", date (eg, \"2021-10-03\"). product_id \"VNP46A3\", date year-month (e.g., \"2021-10-01\", day ignored, \"2021-10\"). product_id \"VNP46A4\", year date  (e.g., \"2021-10-01\", month day ignored, 2021). bearer NASA bearer token. instructions create token, see . aggregation_fun Function used aggregate nighttime lights data polygons; values passed fun argument exactextractr::exact_extract (Default: mean). variable Variable used create raster (default: NULL). NULL, uses following default variables: product_id :VNP46A1\", uses DNB_At_Sensor_Radiance_500m. product_id \"VNP46A2\", uses Gap_Filled_DNB_BRDF-Corrected_NTL. product_ids \"VNP46A3\" \"VNP46A4\", uses NearNadir_Composite_Snow_Free. information variable choices, see ; VNP46A1, see Table 3; VNP46A2 see Table 6; VNP46A3 VNP46A4, see Table 9. quality_flag_rm Quality flag values use set values NA. pixel quality flag value, low quality values can removed. Values set NA value ther quality_flag_rm vector. (Default: c(255)). VNP46A1 VNP46A2 (daily data): 0: High-quality, Persistent nighttime lights 1: High-quality, Ephemeral nighttime Lights 2: Poor-quality, Outlier, potential cloud contamination, issues 255: retrieval, Fill value (masked ingestion) VNP46A3 VNP46A4 (monthly annual data): 0: Good-quality, number observations used composite larger 3 1: Poor-quality, number observations used composite less equal 3 2: Gap filled NTL based historical data 255: Fill value check_all_tiles_exist Check whether Black Marble nighttime light tiles exist region interest. Sometimes tiles available, full region interest may covered. TRUE, skips cases tiles available. (Default: TRUE). output_location_type produce output; either memory file. memory, functions returns raster R. file, function exports .tif file returns NULL. output_location_type = file: file_dir directory data exported (default: NULL, working directory used) file_prefix Prefix add file saved. file saved following: [file_prefix][product_id]_t[date].tif file_skip_if_exists Whether function first check wither file already exists, skip downloading extracting data data date file already exists (default: TRUE). quiet Suppress output show downloading progress messages. (Default: FALSE).","code":""},{"path":"/reference/bm_extract.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract and Aggregate Black Marble Data — bm_extract","text":"Raster","code":""},{"path":"/reference/bm_extract.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract and Aggregate Black Marble Data — bm_extract","text":"","code":"if (FALSE) { # Define bearer token bearer <- \"BEARER-TOKEN-HERE\"  # sf polygon of Ghana library(geodata) roi_sf <- gadm(country = \"GHA\", level=1, path = tempdir()) %>% st_as_sf()  # Daily data: raster for October 3, 2021 ken_20210205_r <- bm_extract(roi_sf = roi_sf,                             product_id = \"VNP46A2\",                             date = \"2021-10-03\",                             bearer = bearer)  # Monthly data: raster for March 2021 ken_202103_r <- bm_extract(roi_sf = roi_sf,                           product_id = \"VNP46A3\",                           date = \"2021-03-01\",                           bearer = bearer)  # Annual data: raster for 2021 ken_2021_r <- bm_extract(roi_sf = roi_sf,                         product_id = \"VNP46A4\",                         date = 2021,                         bearer = bearer) }"},{"path":"/reference/bm_raster.html","id":null,"dir":"Reference","previous_headings":"","what":"Make Black Marble Raster — bm_raster","title":"Make Black Marble Raster — bm_raster","text":"Make raster nighttime lights NASA Black Marble data","code":""},{"path":"/reference/bm_raster.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Make Black Marble Raster — bm_raster","text":"","code":"bm_raster(   roi_sf,   product_id,   date,   bearer,   variable = NULL,   quality_flag_rm = 255,   check_all_tiles_exist = TRUE,   output_location_type = \"memory\",   file_dir = NULL,   file_prefix = NULL,   file_skip_if_exists = TRUE,   quiet = FALSE )"},{"path":"/reference/bm_raster.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Make Black Marble Raster — bm_raster","text":"roi_sf Region interest; sf polygon. Must WGS 84 (epsg:4326) coordinate reference system. product_id One following: \"VNP46A1\": Daily (raw) \"VNP46A2\": Daily (corrected) \"VNP46A3\": Monthly \"VNP46A4\": Annual date Date raster data. Entering one date produce raster. Entering multiple dates produce raster stack. product_ids \"VNP46A1\" \"VNP46A2\", date (eg, \"2021-10-03\"). product_id \"VNP46A3\", date year-month (e.g., \"2021-10-01\", day ignored, \"2021-10\"). product_id \"VNP46A4\", year date  (e.g., \"2021-10-01\", month day ignored, 2021). bearer NASA bearer token. instructions create token, see . variable Variable used create raster (default: NULL). NULL, uses following default variables: product_id :VNP46A1\", uses DNB_At_Sensor_Radiance_500m. product_id \"VNP46A2\", uses Gap_Filled_DNB_BRDF-Corrected_NTL. product_ids \"VNP46A3\" \"VNP46A4\", uses NearNadir_Composite_Snow_Free. information variable choices, see ; VNP46A1, see Table 3; VNP46A2 see Table 6; VNP46A3 VNP46A4, see Table 9. quality_flag_rm Quality flag values use set values NA. pixel quality flag value, low quality values can removed. Values set NA value ther quality_flag_rm vector. (Default: c(255)). VNP46A1 VNP46A2 (daily data): 0: High-quality, Persistent nighttime lights 1: High-quality, Ephemeral nighttime Lights 2: Poor-quality, Outlier, potential cloud contamination, issues 255: retrieval, Fill value (masked ingestion) VNP46A3 VNP46A4 (monthly annual data): 0: Good-quality, number observations used composite larger 3 1: Poor-quality, number observations used composite less equal 3 2: Gap filled NTL based historical data 255: Fill value check_all_tiles_exist Check whether Black Marble nighttime light tiles exist region interest. Sometimes tiles available, full region interest may covered. TRUE, skips cases tiles available. (Default: TRUE). output_location_type produce output; either memory file. memory, functions returns raster R. file, function exports .tif file returns NULL. output_location_type = file: file_dir directory data exported (default: NULL, working directory used) file_prefix Prefix add file saved. file saved following: [file_prefix][product_id]_t[date].tif file_skip_if_exists Whether function first check wither file already exists, skip downloading extracting data data date file already exists (default: TRUE). quiet Suppress output show downloading progress messages. (Default: FALSE).","code":""},{"path":"/reference/bm_raster.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Make Black Marble Raster — bm_raster","text":"Raster","code":""},{"path":"/reference/bm_raster.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Make Black Marble Raster — bm_raster","text":"","code":"if (FALSE) { # Define bearer token bearer <- \"BEARER-TOKEN-HERE\"  # sf polygon of Ghana library(geodata) roi_sf <- gadm(country = \"GHA\", level=0, path = tempdir()) %>% st_as_sf()  # Daily data: raster for October 3, 2021 ken_20210205_r <- bm_raster(roi_sf = roi_sf,                             product_id = \"VNP46A2\",                             date = \"2021-10-03\",                             bearer = bearer)  # Monthly data: raster for March 2021 ken_202103_r <- bm_raster(roi_sf = roi_sf,                           product_id = \"VNP46A3\",                           date = \"2021-03-01\",                           bearer = bearer)  # Annual data: raster for 2021 ken_2021_r <- bm_raster(roi_sf = roi_sf,                         product_id = \"VNP46A4\",                         date = 2021,                         bearer = bearer) }"},{"path":"/reference/bm_tiles_sf.html","id":null,"dir":"Reference","previous_headings":"","what":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","title":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","text":"Black Marble Tile Grid Shapefile dataset containing black marble grid tiles.","code":""},{"path":"/reference/bm_tiles_sf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","text":"","code":"data(bm_tiles_sf)"},{"path":"/reference/bm_tiles_sf.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","text":"Sf polygon 648 features","code":""},{"path":"/reference/bm_tiles_sf.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","text":"https://blackmarble.gsfc.nasa.gov/","code":""},{"path":"/reference/bm_tiles_sf.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","text":"Robert Marty rmarty@worldbank.org","code":""}]
