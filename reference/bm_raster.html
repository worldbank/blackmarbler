<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Make Black Marble Raster — bm_raster • blackmarbler</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Make Black Marble Raster — bm_raster"><meta name="description" content="Make a raster of nighttime lights from NASA Black Marble data"><meta property="og:description" content="Make a raster of nighttime lights from NASA Black Marble data"><meta property="og:image" content="/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">blackmarbler</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/assess-quality.html">Assessing Quality of Nighttime Lights Data</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/worldbank/blackmarbler/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Make Black Marble Raster</h1>
      <small class="dont-index">Source: <a href="https://github.com/worldbank/blackmarbler/blob/main/R/blackmarbler.R" class="external-link"><code>R/blackmarbler.R</code></a></small>
      <div class="d-none name"><code>bm_raster.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Make a raster of nighttime lights from <a href="https://blackmarble.gsfc.nasa.gov/" class="external-link">NASA Black Marble data</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bm_raster</span><span class="op">(</span></span>
<span>  <span class="va">roi_sf</span>,</span>
<span>  <span class="va">product_id</span>,</span>
<span>  <span class="va">date</span>,</span>
<span>  <span class="va">bearer</span>,</span>
<span>  variable <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quality_flag_rm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  check_all_tiles_exist <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  interpol_na <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  output_location_type <span class="op">=</span> <span class="st">"memory"</span>,</span>
<span>  file_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  file_prefix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  file_skip_if_exists <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  file_return_null <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  h5_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-roi-sf">roi_sf<a class="anchor" aria-label="anchor" href="#arg-roi-sf"></a></dt>
<dd><p>Region of interest; sf polygon. Must be in the <a href="https://epsg.io/4326" class="external-link">WGS 84 (epsg:4326)</a> coordinate reference system.</p></dd>


<dt id="arg-product-id">product_id<a class="anchor" aria-label="anchor" href="#arg-product-id"></a></dt>
<dd><p>One of the following:</p><ul><li><p><code>"VNP46A1"</code>: Daily (raw)</p></li>
<li><p><code>"VNP46A2"</code>: Daily (corrected)</p></li>
<li><p><code>"VNP46A3"</code>: Monthly</p></li>
<li><p><code>"VNP46A4"</code>: Annual</p></li>
</ul></dd>


<dt id="arg-date">date<a class="anchor" aria-label="anchor" href="#arg-date"></a></dt>
<dd><p>Date of raster data. Entering one date will produce a <code>SpatRaster</code> object. Entering multiple dates will produce a <code>SpatRaster</code> object with multiple bands; one band per date.</p><ul><li><p>For <code>product_id</code>s <code>"VNP46A1"</code> and <code>"VNP46A2"</code>, a date (eg, <code>"2021-10-03"</code>).</p></li>
<li><p>For <code>product_id</code> <code>"VNP46A3"</code>, a date or year-month (e.g., <code>"2021-10-01"</code>, where the day will be ignored, or <code>"2021-10"</code>).</p></li>
<li><p>For <code>product_id</code> <code>"VNP46A4"</code>, year or date  (e.g., <code>"2021-10-01"</code>, where the month and day will be ignored, or <code>2021</code>).</p></li>
</ul></dd>


<dt id="arg-bearer">bearer<a class="anchor" aria-label="anchor" href="#arg-bearer"></a></dt>
<dd><p>NASA bearer token. For instructions on how to create a token, see <a href="https://github.com/worldbank/blackmarbler#bearer-token-" class="external-link">here</a>.</p></dd>


<dt id="arg-variable">variable<a class="anchor" aria-label="anchor" href="#arg-variable"></a></dt>
<dd><p>Variable to used to create raster (default: <code>NULL</code>). If <code>NULL</code>, uses the following default variables:</p><ul><li><p>For <code>product_id</code> <code>:VNP46A1"</code>, uses <code>DNB_At_Sensor_Radiance_500m</code>.</p></li>
<li><p>For <code>product_id</code> <code>"VNP46A2"</code>, uses <code>Gap_Filled_DNB_BRDF-Corrected_NTL</code>.</p></li>
<li><p>For <code>product_id</code>s <code>"VNP46A3"</code> and <code>"VNP46A4"</code>, uses <code>NearNadir_Composite_Snow_Free</code>.
To see all variable choices, set <code>variable = ""</code> (this will create an error message that lists all valid variables). For additional information on variable choices, see <a href="https://ladsweb.modaps.eosdis.nasa.gov/api/v2/content/archives/Document%20Archive/Science%20Data%20Product%20Documentation/VIIRS_Black_Marble_UG_v1.2_April_2021.pdf" class="external-link">here</a>; for <code>VNP46A1</code>, see Table 3; for <code>VNP46A2</code> see Table 6; for <code>VNP46A3</code> and <code>VNP46A4</code>, see Table 9.</p></li>
</ul></dd>


<dt id="arg-quality-flag-rm">quality_flag_rm<a class="anchor" aria-label="anchor" href="#arg-quality-flag-rm"></a></dt>
<dd><p>Quality flag values to use to set values to <code>NA</code>. Each pixel has a quality flag value, where low quality values can be removed. Values are set to <code>NA</code> for each value in the <code>quality_flag_rm</code> vector. Note that <code>quality_flag_rm</code> does not apply for <code>VNP46A1</code>. (Default: <code>NULL</code>).</p>
<p>For <code>VNP46A2</code> (daily data):</p><ul><li><p><code>0</code>: High-quality, Persistent nighttime lights</p></li>
<li><p><code>1</code>: High-quality, Ephemeral nighttime Lights</p></li>
<li><p><code>2</code>: Poor-quality, Outlier, potential cloud contamination, or other issues</p></li>
</ul><p>For <code>VNP46A3</code> and <code>VNP46A4</code> (monthly and annual data):</p><ul><li><p><code>0</code>: Good-quality, The number of observations used for the composite is larger than 3</p></li>
<li><p><code>1</code>: Poor-quality, The number of observations used for the composite is less than or equal to 3</p></li>
<li><p><code>2</code>: Gap filled NTL based on historical data</p></li>
</ul></dd>


<dt id="arg-check-all-tiles-exist">check_all_tiles_exist<a class="anchor" aria-label="anchor" href="#arg-check-all-tiles-exist"></a></dt>
<dd><p>Check whether all Black Marble nighttime light tiles exist for the region of interest. Sometimes not all tiles are available, so the full region of interest may not be covered. If <code>TRUE</code>, skips cases where not all tiles are available. (Default: <code>TRUE</code>).</p></dd>


<dt id="arg-interpol-na">interpol_na<a class="anchor" aria-label="anchor" href="#arg-interpol-na"></a></dt>
<dd><p>When data for more than one date is downloaded, whether to interpolate <code>NA</code> values using the <code><a href="https://rspatial.github.io/terra/reference/approximate.html" class="external-link">terra::approximate</a></code> function. Additional arguments for the <code><a href="https://rspatial.github.io/terra/reference/approximate.html" class="external-link">terra::approximate</a></code> function can also be passed into <code>bm_raster</code> (eg, <code>method</code>, <code>rule</code>, <code>f</code>, <code>ties</code>, <code>z</code>, <code>NA_rule</code>). (Default: <code>FALSE</code>).</p></dd>


<dt id="arg-output-location-type">output_location_type<a class="anchor" aria-label="anchor" href="#arg-output-location-type"></a></dt>
<dd><p>Where to produce output; either <code>memory</code> or <code>file</code>. If <code>memory</code>, functions returns a raster in R. If <code>file</code>, function exports a <code>.tif</code> file and returns <code>NULL</code>.
For <code>output_location_type = file</code>:</p></dd>


<dt id="arg-file-dir">file_dir<a class="anchor" aria-label="anchor" href="#arg-file-dir"></a></dt>
<dd><p>The directory where data should be exported (default: <code>NULL</code>, so the working directory will be used)</p></dd>


<dt id="arg-file-prefix">file_prefix<a class="anchor" aria-label="anchor" href="#arg-file-prefix"></a></dt>
<dd><p>Prefix to add to the file to be saved. The file will be saved as the following: <code>[file_prefix][product_id]_t[date].tif</code></p></dd>


<dt id="arg-file-skip-if-exists">file_skip_if_exists<a class="anchor" aria-label="anchor" href="#arg-file-skip-if-exists"></a></dt>
<dd><p>Whether the function should first check wither the file already exists, and to skip downloading or extracting data if the data for that date if the file already exists (default: <code>TRUE</code>).</p></dd>


<dt id="arg-file-return-null">file_return_null<a class="anchor" aria-label="anchor" href="#arg-file-return-null"></a></dt>
<dd><p>Whether to return <code>NULL</code> instead of a <code>SpatRaster</code>. When <code>output_location_type = 'file'</code>, the function will export data to the <code>file_dir</code> directory. When <code>file_return_null = FALSE</code>, the function will also return a <code>SpatRaster</code> of the queried data—so the data is available in R memory. Setting <code>file_return_null = TRUE</code>, data will be saved to <code>file_dir</code> but no data will be returned by the function to R memory (default: <code>FALSE</code>).</p></dd>


<dt id="arg-h-dir">h5_dir<a class="anchor" aria-label="anchor" href="#arg-h-dir"></a></dt>
<dd><p>Black Marble data are originally downloaded as <code>h5</code> files. If <code>h5_dir = NULL</code>, the function downloads to a temporary directory then deletes the directory. If <code>h5_dir</code> is set to a path, <code>h5</code> files are saved to that directory and not deleted. The function will then check if the needed <code>h5</code> file already exists in the directory; if it exists, the function will not re-download the <code>h5</code> file.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Suppress output that show downloading progress and other messages. (Default: <code>FALSE</code>).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments for <code><a href="https://rspatial.github.io/terra/reference/approximate.html" class="external-link">terra::approximate</a></code>, if <code>interpol_na = TRUE</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Raster</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robert Marty <a href="mailto:rmarty@worldbank.org">rmarty@worldbank.org</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Define bearer token</span></span></span>
<span class="r-in"><span><span class="va">bearer</span> <span class="op">&lt;-</span> <span class="st">"BEARER-TOKEN-HERE"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># sf polygon of Ghana</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">geodata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">roi_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geodata/man/gadm.html" class="external-link">gadm</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"GHA"</span>, level<span class="op">=</span><span class="fl">0</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Daily data: raster for October 3, 2021</span></span></span>
<span class="r-in"><span><span class="va">ken_20210205_r</span> <span class="op">&lt;-</span> <span class="fu">bm_raster</span><span class="op">(</span>roi_sf <span class="op">=</span> <span class="va">roi_sf</span>,</span></span>
<span class="r-in"><span>                            product_id <span class="op">=</span> <span class="st">"VNP46A2"</span>,</span></span>
<span class="r-in"><span>                            date <span class="op">=</span> <span class="st">"2021-10-03"</span>,</span></span>
<span class="r-in"><span>                            bearer <span class="op">=</span> <span class="va">bearer</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Monthly data: raster for March 2021</span></span></span>
<span class="r-in"><span><span class="va">ken_202103_r</span> <span class="op">&lt;-</span> <span class="fu">bm_raster</span><span class="op">(</span>roi_sf <span class="op">=</span> <span class="va">roi_sf</span>,</span></span>
<span class="r-in"><span>                          product_id <span class="op">=</span> <span class="st">"VNP46A3"</span>,</span></span>
<span class="r-in"><span>                          date <span class="op">=</span> <span class="st">"2021-03-01"</span>,</span></span>
<span class="r-in"><span>                          bearer <span class="op">=</span> <span class="va">bearer</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Annual data: raster for 2021</span></span></span>
<span class="r-in"><span><span class="va">ken_2021_r</span> <span class="op">&lt;-</span> <span class="fu">bm_raster</span><span class="op">(</span>roi_sf <span class="op">=</span> <span class="va">roi_sf</span>,</span></span>
<span class="r-in"><span>                        product_id <span class="op">=</span> <span class="st">"VNP46A4"</span>,</span></span>
<span class="r-in"><span>                        date <span class="op">=</span> <span class="fl">2021</span>,</span></span>
<span class="r-in"><span>                        bearer <span class="op">=</span> <span class="va">bearer</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Marty, Gabriel Stefanini Vicente.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

